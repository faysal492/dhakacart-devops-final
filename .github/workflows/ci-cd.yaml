name: DhakaCart CI/CD Pipeline

on:
  push:
    branches:
      - main
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Build backend image
        run: |
          docker build -t dhakacart-backend:latest docker/backend
          echo "Backend image built successfully"

      - name: Build frontend image
        run: |
          docker build -t dhakacart-frontend:latest docker/frontend
          echo "Frontend image built successfully"

      - name: List built images
        run: docker images | grep dhakacart

      - name: Run basic backend image test
        run: |
          docker inspect dhakacart-backend:latest > /dev/null
          echo "✅ Backend image validation passed"

      - name: Run basic frontend image test
        run: |
          docker inspect dhakacart-frontend:latest > /dev/null
          echo "✅ Frontend image validation passed"

      - name: Build summary
        run: |
          echo "=== CI/CD Pipeline Summary ==="
          echo "✅ Source code checked out from main branch"
          echo "✅ Backend Docker image built successfully"
          echo "✅ Frontend Docker image built successfully"
          echo "✅ Both images validated"
          echo ""
          echo "Next steps (deployment):"
          echo "• Push to registry: docker push <username>/dhakacart-backend:latest"
          echo "• Deploy to Kubernetes with rolling updates"
          echo "• Health checks monitor pod readiness"
          echo "• Automatic rollback on deployment failure"
